<!DOCTYPE html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>treeComponent</title>
</head>
<!-- add un-tree js -->
<script src="./un-tree.min.js"></script>

<body>
    <!-- Load button, for testing -->
    <input type="button" title="Loadtree" value="Loadtree" onclick="loading()" />
    <!-- Tree structure content -->
    <div id="un-tree--wrapper"></div>
</body>
<script type="text/javascript">

    // Test default data
    let data = [
        {
            "id": "1",
            "text": "topNode",
            "parent": "root",
            "children": []
        },
        {
            "id": "2",
            "text": "node1",
            "parent": "1",
            "children": []
        },
        {
            "id": "3",
            "text": "node2",
            "parent": "1",
            "children": []
        },
        {
            "id": "4",
            "text": "node3",
            "parent": "2",
            "children": []
        },
        {
            "id": "5",
            "text": "node4",
            "parent": "2",
            "children": []
        },
        {
            "id": "6",
            "text": "node5",
            "parent": "3",
            "children": []
        },
        {
            "id": "7",
            "text": "node6",
            "parent": "5",
            "children": []
        },
        {
            "id": "8",
            "text": "node7",
            "parent": "5",
            "children": []
        },
        {
            "id": "9",
            "text": "node8",
            "parent": "5",
            "children": []
        },
        {
            "id": "10",
            "text": "node9",
            "parent": "6",
            "children": []
        },
        {
            "id": "11",
            "text": "node10",
            "parent": "7",
            "children": []
        },
        {
            "id": "12",
            "text": "node11",
            "parent": "7",
            "children": []
        },
        {
            "id": "13",
            "text": "node12",
            "parent": "8",
            "children": []
        }
    ];

    //Default data, take the data whose parent is root
    let defaultData;

    //Get to the DOM element of the tree
    let treeEle = document.getElementById("un-tree--wrapper");

    // Loading tree method
    function loading() {
        defaultData = [];
        // Get the default tree top node data
        let topNode = getSubNodeList('root',null);
        //Note here that a tree has only one top node, and if more than one is obtained, it is considered wrong data and is not allowed to build the tree
        if (topNode.length > 1) {
            alert("Build tree error with multiple tree top-level nodes!")
            return;
        }
        defaultData = topNode;
        //Build tree
        rebuildTree(defaultData);
    }

    // Tree node click method
    function handleClick(itemId, itemData, itemNode) {
        //Simulate calling the interface to get node child data
        let subNodeList = getSubNodeList(itemId,itemData);
        //Call to rebuild the tree
        rebuildTree(subNodeList);
    }

    // Simulate calling the interface to get the child node data of the node
    function getSubNodeList(parentId,nodeData) {
        // Define a child node data
        let subNode = defaultData;
        let subNodeCount = 0;
        for (let i = 0; i < data.length; i++) {
            const d = data[i];
            //Get all the subordinate node data of the selected node and add it to the subset of the selected node, or not add it if the node already exists
            if (d['parent'] == parentId && subNode.indexOf(d) < 0) {
                subNode.push(d);
                subNodeCount++;
            }
        }
        // Determine if the node has children, and if not, prompt for them
        if (subNodeCount == 0) {
            alert("Node：“" + nodeData['text'] + "”No child node data！")
        }
        return subNode;
    }

    // Rebuild tree method
    function rebuildTree(treeData) {
        new UNTree({
            el: treeEle,
            jsonArr: treeData, // Data for building the tree
            parentld: "root", // The default parent of the root node is root
            type: "list",// Use array format data by default
            viewClass: "view-demo", // The css style class of the tree node, fixed
            itemClass: "item-demo", // The css style class of the tree node, fixed
            click: handleClick, // Methods called by node click
        });
    }
</script>

</html>